{"ast":null,"code":"\"use client\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\ahmed\\\\OneDrive\\\\Documents\\\\github_easy_cars\\\\easy_cars\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport api from \"../api\";\nimport { createContext, useState, useEffect } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(localStorage.getItem(\"token\"));\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Load user on initial render\n  useEffect(() => {\n    const loadUser = async () => {\n      if (token) {\n        setAuthToken(token);\n        try {\n          const res = await api.get(\"/auth/profile\");\n          setUser(res.data.data);\n          setIsAuthenticated(true);\n          // Clear any auth errors when successfully authenticated\n          setError(null);\n        } catch (err) {\n          var _err$response, _err$response$data;\n          localStorage.removeItem(\"token\");\n          setToken(null);\n          setUser(null);\n          setIsAuthenticated(false);\n          setError(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || \"Authentication failed\");\n        }\n      }\n      setLoading(false);\n    };\n    loadUser();\n  }, [token]);\n\n  // Set token in headers\n  const setAuthToken = token => {\n    if (token) {\n      api.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\n      localStorage.setItem(\"token\", token);\n    } else {\n      delete api.defaults.headers.common[\"Authorization\"];\n      localStorage.removeItem(\"token\");\n    }\n  };\n\n  // Register user\n  const register = async formData => {\n    // Clear any previous errors before attempting registration\n    setError(null);\n    try {\n      console.log('Registering with:', formData);\n      const res = await api.post(\"/auth/register\", formData);\n      setToken(res.data.token);\n      setUser(res.data.user);\n      setIsAuthenticated(true);\n      setLoading(false);\n      return res.data;\n    } catch (err) {\n      var _err$response2, _err$response2$data;\n      setError(((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || \"Registration failed\");\n      throw err;\n    }\n  };\n\n  // Login user\n  const login = async formData => {\n    // Clear any previous errors before attempting login\n    setError(null);\n    try {\n      const res = await api.post(\"/auth/login\", formData);\n      setToken(res.data.token);\n      setUser(res.data.user);\n      setIsAuthenticated(true);\n      setLoading(false);\n      return res.data;\n    } catch (err) {\n      var _err$response3, _err$response3$data;\n      setError(((_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : (_err$response3$data = _err$response3.data) === null || _err$response3$data === void 0 ? void 0 : _err$response3$data.message) || \"Login failed\");\n      throw err;\n    }\n  };\n\n  // Logout user\n  const logout = () => {\n    setToken(null);\n    setUser(null);\n    setIsAuthenticated(false);\n    setError(null);\n  };\n\n  // Clear any authentication errors\n  const clearError = () => {\n    setError(null);\n  };\n\n  // Update user profile\n  const updateProfile = async formData => {\n    // Clear any previous errors before attempting profile update\n    setError(null);\n    try {\n      const res = await api.put(\"/users/update-profile\", formData);\n      setUser(res.data.data);\n      return res.data;\n    } catch (err) {\n      var _err$response4, _err$response4$data;\n      setError(((_err$response4 = err.response) === null || _err$response4 === void 0 ? void 0 : (_err$response4$data = _err$response4.data) === null || _err$response4$data === void 0 ? void 0 : _err$response4$data.message) || \"Profile update failed\");\n      throw err;\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      token,\n      isAuthenticated,\n      loading,\n      error,\n      register,\n      login,\n      logout,\n      updateProfile,\n      clearError\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 123,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"uU6IHWeRkaaSwG/RGLZ7SdfFc98=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["_jsxFileName","_s","$RefreshSig$","api","createContext","useState","useEffect","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","user","setUser","token","setToken","localStorage","getItem","isAuthenticated","setIsAuthenticated","loading","setLoading","error","setError","loadUser","setAuthToken","res","get","data","err","_err$response","_err$response$data","removeItem","response","message","defaults","headers","common","setItem","register","formData","console","log","post","_err$response2","_err$response2$data","login","_err$response3","_err$response3$data","logout","clearError","updateProfile","put","_err$response4","_err$response4$data","Provider","value","fileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/ahmed/OneDrive/Documents/github_easy_cars/easy_cars/frontend/src/context/AuthContext.js"],"sourcesContent":["\"use client\"\r\nimport api from \"../api\"\r\nimport { createContext, useState, useEffect } from \"react\"\r\n\r\n\r\nexport const AuthContext = createContext()\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null)\r\n  const [token, setToken] = useState(localStorage.getItem(\"token\"))\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false)\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState(null)\r\n\r\n  // Load user on initial render\r\n  useEffect(() => {\r\n    const loadUser = async () => {\r\n      if (token) {\r\n        setAuthToken(token)\r\n        try {\r\n          const res = await api.get(\"/auth/profile\")\r\n          setUser(res.data.data)\r\n          setIsAuthenticated(true)\r\n          // Clear any auth errors when successfully authenticated\r\n          setError(null)\r\n        } catch (err) {\r\n          localStorage.removeItem(\"token\")\r\n          setToken(null)\r\n          setUser(null)\r\n          setIsAuthenticated(false)\r\n          setError(err.response?.data?.message || \"Authentication failed\")\r\n        }\r\n      }\r\n      setLoading(false)\r\n    }\r\n\r\n    loadUser()\r\n  }, [token])\r\n\r\n  // Set token in headers\r\n  const setAuthToken = (token) => {\r\n    if (token) {\r\n      api.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`\r\n      localStorage.setItem(\"token\", token)\r\n    } else {\r\n      delete api.defaults.headers.common[\"Authorization\"]\r\n      localStorage.removeItem(\"token\")\r\n    }\r\n  }\r\n\r\n  // Register user\r\n  const register = async (formData) => {\r\n    // Clear any previous errors before attempting registration\r\n    setError(null)\r\n    \r\n    try {\r\n      console.log('Registering with:', formData);\r\n      const res = await api.post(\"/auth/register\", formData)\r\n\r\n      setToken(res.data.token)\r\n      setUser(res.data.user)\r\n      setIsAuthenticated(true)\r\n      setLoading(false)\r\n\r\n      return res.data\r\n    } catch (err) {\r\n      setError(err.response?.data?.message || \"Registration failed\")\r\n      throw err\r\n    }\r\n  }\r\n\r\n  // Login user\r\n  const login = async (formData) => {\r\n    // Clear any previous errors before attempting login\r\n    setError(null)\r\n    \r\n    try {\r\n      const res = await api.post(\"/auth/login\", formData)\r\n\r\n      setToken(res.data.token)\r\n      setUser(res.data.user)\r\n      setIsAuthenticated(true)\r\n      setLoading(false)\r\n\r\n      return res.data\r\n    } catch (err) {\r\n      setError(err.response?.data?.message || \"Login failed\")\r\n      throw err\r\n    }\r\n  }\r\n\r\n  // Logout user\r\n  const logout = () => {\r\n    setToken(null)\r\n    setUser(null)\r\n    setIsAuthenticated(false)\r\n    setError(null)\r\n  }\r\n\r\n  // Clear any authentication errors\r\n  const clearError = () => {\r\n    setError(null)\r\n  }\r\n\r\n  // Update user profile\r\n  const updateProfile = async (formData) => {\r\n    // Clear any previous errors before attempting profile update\r\n    setError(null)\r\n    \r\n    try {\r\n      const res = await api.put(\"/users/update-profile\", formData)\r\n\r\n      setUser(res.data.data)\r\n\r\n      return res.data\r\n    } catch (err) {\r\n      setError(err.response?.data?.message || \"Profile update failed\")\r\n      throw err\r\n    }\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        token,\r\n        isAuthenticated,\r\n        loading,\r\n        error,\r\n        register,\r\n        login,\r\n        logout,\r\n        updateProfile,\r\n        clearError,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}